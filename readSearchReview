<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="u" tagdir="/WEB-INF/tags"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ page import="util.Token"%>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="css/NewBasic.css">


<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="js/slides.min.jquery.js"></script>
<script language='javascript'>
	function noEvent() {
		if (event.keyCode == 116) {
			event.keyCode = 2;
			return false;
		} else if (event.ctrlKey
				&& (event.keyCode == 78 || event.keyCode == 82)) {
			return false;
		}
	}
	document.onkeydown = noEvent;

	function writeCheck(frm) {
		//검색
		var Value = frm.content.value;

		if ($.trim(Value) == "") {
			alert("등록할 댓글을 입력하세요.");
			$('#wordbox').val('');
			frm.keyWord.focus();
			return;
		}
		frm.submit();
	}

	function delchk() {
		var check = confirm("댓글을 삭제하시겠습니까?");
		//return false, true;
		if (check) {
			alert("댓글이 삭제되었습니다.");
			return true;
		} else {
			alert("댓글 삭제가 취소되었습니다.");
			return false;
		}
	}

	function reviewdelchk() {
		var check = confirm("현재 게시글을 삭제하시겠습니까?");
		//return false, true;
		if (check) {
			alert("게시글이 삭제되었습니다.");
			return true;
		} else {
			alert("게시글 삭제가 취소되었습니다.");
			return false;
		}
	}
</script>
<title>검색된 게시글 읽기</title>
</head>
<body>
	<%
		if (request.getAttribute("TOKEN_KEY") == null)
			Token.set(request);
	%>
	<div id="wrapper">
		<header>
			<jsp:include page="header.jsp"></jsp:include>
		</header>
		<article>
			<section>

				<table border="1" width="100%">

					<tr>
						<td>번호</td>
						<td>${searchReviewData.review.rv_num }</td>
					</tr>



					<tr>
						<td>작성자</td>
						<td><c:out value="${searchReviewData.review.rv_m_id }"></c:out></td>
					</tr>

					<tr>
						<td>조회수</td>
						<td><c:out value="${searchReviewData.review.rv_readcnt }"></c:out></td>
					</tr>
					<tr>
						<td>작성일</td>

						<td><fmt:formatDate
								value="${searchReviewData.review.rv_regdate }"
								pattern="yyyy/MM/dd hh:mm:ss" /></td>
					</tr>

					<tr>
						<td>본영화</td>
						<td><c:out value="${searchReviewData.review.rv_mv_num }"></c:out></td>
					</tr>

					<tr>
						<td>본영화제목</td>
						<td><c:out value="${searchReviewData.review.movie.mv_title }"></c:out></td>
					</tr>
					<tr>
						<td>제목</td>
						<td><c:out value="${searchReviewData.review.rv_title }"></c:out></td>
					</tr>
					<tr>
						<td>내용</td>
						<td><u:pre value='${searchReviewData.content }' /></td>
					</tr>

					<tr>
						<td colspan="2"><c:set var="pageNo"
								value="${empty param.pageNo ? '1' : param.pageNo }"></c:set> <a
							href="reviewsearch.do?pageNo=${pageNo }&keyField=${keyField}&keyWord=${keyWord}&reviewSort=${reviewSort}">[목록]</a>
							<c:if test="${authUser.id == searchReviewData.review.rv_m_id }">
								<a
									href="reviewmodify.do?rv_num=${searchReviewData.review.rv_num }&pageNo=${pageNo }&reviewSort=${reviewSort}">[게시글
									수정]</a>
								<a
									href="reviewdelete.do?rv_num=${searchReviewData.review.rv_num }&pageNo=${pageNo }&reviewSort=${reviewSort}"
									onclick="return reviewdelchk()">[게시글 삭제]</a>
							</c:if></td>
					</tr>
				</table>
				<!-- 댓글 목록-->
				<table border="1">
					<tr>
						<td colspan="3">댓글 목록</td>
					</tr>

					<c:forEach var="reply" items="${replyPage.content}">
						<tr>
							<!-- 아이디, 작성일 -->
							<td>
								<div>
									아이디 : ${reply.rp_m_id}<br> 작성일 :
									<fmt:formatDate value="${reply.rp_regdate}" pattern="yy/MM/dd"></fmt:formatDate>
								</div>
							</td>

							<!-- 댓글 내용 -->
							<td>
								<div>
									<u:pre value='${reply.rp_content}' />
								</div>

							</td>
							<!-- 버튼 -->
							<c:if test="${authUser.id == reply.rp_m_id}">
								<td>
									<div>
										<a
											href="reviewsearchmodifyReply.do?rp_num=${reply.rp_num}&rp_rv_num=${searchReviewData.review.rv_num }&replypageNo=${replyPage.currentPage}&reviewSort=${reviewSort}&pageNo=${pageNo}&keyField=${keyField}&keyWord=${keyWord}">
											<input type="button" value="수정">

										</a>
										<p>

											<a
												href="reviewsearchdeleteReply.do?rp_num=${reply.rp_num}&rp_rv_num=${searchReviewData.review.rv_num }&replypageNo=${replyPage.currentPage}&reviewSort=${reviewSort}&pageNo=${pageNo }&keyField=${keyField}&keyWord=${keyWord}"
												onclick="return delchk()"><input type="button"
												value="삭제"> </a>
									</div>
								</td>
							</c:if>
						</tr>


					</c:forEach>
					<c:if test="${replyPage.hasReplies() }">
						<tr>
							<td colspan="4"><c:if test="${replyPage.startPage > 5}">
									<a
										href="reviewsearchlistReply.do?replypageNo=${replyPage.startPage - 5}&rv_num=${searchReviewData.review.rv_num  }&reviewSort=${reviewSort}&pageNo=${pageNo }&keyField=${keyField}&keyWord=${keyWord}">[이전]
									</a>
								</c:if> <c:forEach var="pNo" begin="${replyPage.startPage }"
									end="${replyPage.endPage }">
									<a
										href="reviewsearchlistReply.do?replypageNo=${pNo}&rv_num=${searchReviewData.review.rv_num }&reviewSort=${reviewSort}&pageNo=${pageNo }&keyField=${keyField}&keyWord=${keyWord}">[${pNo }]</a>
								</c:forEach> <c:if test="${replyPage.endPage < replyPage.totalPages }">
									<a
										href="reviewsearchlistReply.do?replypageNo=${replyPage.startPage + 5}&rv_num=${searchReviewData.review.rv_num  }&reviewSort=${reviewSort}&pageNo=${pageNo }&keyField=${keyField}&keyWord=${keyWord}">[다음]</a>
								</c:if></td>
						</tr>
					</c:if>
				</table>
				<!-- 댓글쓰기 폼 -->
				<c:if test="${! empty authUser}">
					<table border="1">
						<tr>
							<td>댓글 쓰기</td>
						</tr>
						<tr>
							<td>

								<form action="reviewsearchwriteReply.do">
									<textarea name="content" id="wordbox" cols="50" rows="3"></textarea>
									<br>
									<!-- 게시글번호 -->
									<input type="hidden" name="rp_rv_num"
										value="${searchReviewData.review.rv_num }"><br>
									<!-- 소팅 -->
									<input type="hidden" name="reviewSort" value="${reviewSort}"><br>
									<!-- 현재페이지번호 -->
									<input type="hidden" name="pageNo" value="${pageNo }"><br>

									<input type="hidden" name="keyField" value="${keyField }"><br>
									<input type="hidden" name="keyWord" value="${keyWord }"><br>
									<!-- 리플페이지번호 -->
									<input type="hidden" name="replyEndPage"
										value="${replyPage.endPage}"> <input type="hidden"
										name="TOKEN_KEY"
										value="<%=request.getAttribute("TOKEN_KEY")%>" /> <input
										type="button" value="댓글 등록" onclick="writeCheck(form)">

								</form> <br>
							</td>
						</tr>
					</table>
					<!-- 		</form> -->
				</c:if>

			</section>
		</article>
<%-- 
		<footer>
			<jsp:include page="footer.jsp"></jsp:include>
		</footer> --%>
	</div>

</body>
</html>
